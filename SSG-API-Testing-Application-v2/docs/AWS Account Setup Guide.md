# AWS Account Setup Guide

> [!NOTE]
> This guide is for administrators who wish to set up an AWS account to host the SSG API Testing Application.
> We will go through the entire process of setting up your root account, creating IAM users, and setting up
> your own AWS Organization.
> 
> If you are not an administrator, you may still follow the first two steps and final step to set up your AWS account!

Welcome to the AWS Account Setup Guide!

## Table of Contents

* [Creating your AWS Account](#creating-your-aws-account)
* [Setting up your Root Account](#setting-up-your-root-account)
* [Setting up AWS Organization](#setting-up-aws-organization)
* [Restrict AWS Regions](#restrict-aws-regions)
* [Programmatic Access to AWS](#programmatic-access-to-aws)
* [Conclusion](#conclusion)

## Creating your AWS Account

To create an AWS account, follow the steps below:

1. Head over to the [Signup Portal](https://signin.aws.amazon.com/signup?request_type=register)
2. Enter your email and your AWS account username to continue.
3. Follow the on-screen instructions to create your AWS Account.

Once you are done, log into the AWS Management Console using your root account.

## Setting up your Root Account

After you have created your root account, it is important to follow the steps below to secure your account:

1. Enable Multi-Factor Authentication (MFA) for your root account
    1. Click on your username in the top right corner of the AWS Management Console
    2. Click on `Security Credentials`
    3. Navigate to the Multi-Factor Authentication (MFA) section
    4. Click on `Assign MFA device`
    5. Give your MFA device a name, and select the type of MFA device you are using
    6. Follow the on-screen instructions to complete the setup
2. Create an IAM account and assign it administrative permissions
    1. Click on the search bar at the top of the page and type "IAM", and then select the IAM service
    2. Click on `Users` on the left sidebar
    3. Click on `Create user`
    4. Give your user a name
    5. Select `Provide user access to the AWS Management Console - optional`
    6. Select "I want to create an IAM user"
    7. Either select `Autogenerated password` or `Custom password` (and then fill in the password field with a
       password of your choice) for your user
    8. Select or unselect the `Users must create a new password at next sign-in - Recommended`
    9. Click on `Next`
    10. Check if the group `admin` exists, if it does not, follow the steps below
        1. If the group `admin` does not exist, click on "Create group"
        2. Give the group a name (e.g. `admin`)
        3. Assign the group the `AdministratorAccess` policy
        4. Click on `Create user group`
    11. If the group `admin` exists, select the group by clicking on the checkbox next to the group name
    12. Click on `Next`
    13. Review the details of your IAM account, and then click on `Create user`
    14. Download the `.csv` file containing your IAM account details, or save the console sign-in URL, username and
        password in a secure location
3. Log into the AWS Management Console using your IAM account. Only use the `root` account for billing and
   administrative purposes; all other actions should be done using your IAM account.

## Setting up AWS Organization

To allow you to better control and manage your AWS accounts, you can create an AWS Organization.

1. Click on the search bar at the top of the page and type "Organizations", and then select the AWS Organizations
   service
2. Click on `Create an organization`
3. To add users, click on `Add an AWS account` under the `AWS accounts` page
    1. Note that you can only create or invite AWS accounts under the Root directory first. You move the account
       around to other Operational Units (OUs) later.
4. If the user you wish to add does not have an existing AWS account, select the `Create an AWS account` option and
   follow the steps below:
    1. Enter the AWS account name you wish to assign to the new account
    2. Enter the email associated with the AWS account
    3. Leave the IAM role field as is (`OrganizationAccountAccessRole` provides you as the administrator access to the
       member accounts that you create via AWS Organizations by allowing you to assume the role)
    4. Click on `Create account`. This will send the user an email that they now have an AWS account created using their
       email
    5. Instruct your users to follow the instructions below to set up their AWS account
        1. Go to the [Signup Portal](https://signin.aws.amazon.com/signup?request_type=register)
        2. Sign in as a root user by entering the email that was used to create their AWS account
        3. Click on `Forgot password?`. This will send a password reset email to the email address used to create the
           account
        4. Follow the instructions in the email to reset the password
        5. Sign into the AWS Management Console using the email and the new password
        6. Follow the [instructions above](#Setting-up-your-Root-Account) to secure their root account.
5. If the user you wish to add already has an existing AWS account, select the `Invite an existing AWS account` option
   and follow the steps below:
    1. Enter the email associated with the AWS account or their AWS account ID
    2. (Optional) Include a message in the invitation email
    3. Click on `Send invitation`.
    4. Instruct your users to follow the instructions below to accept the invitation
        1. Check their email for an invitation from AWS
        2. Click on the link in the email to accept the invitation
        3. Follow the on-screen instructions to accept the invitation
6. The user should now appear in your Organization
7. To create an Organizational Unit (OU), click on the checkbox next to `Root` and click on the `Action` dropdown menu.
   Click on `Create new` under the `Organizational units` section.
8. Give your organizational unit a name and click on `Create organizational unit`
9. To move an account to an OU, click on the checkbox next to the account you wish to move, click on the `Action`
   dropdown menu, and then click on `Move` under the `AWS account` section. Select the OU you wish to move the account
   to and click on `Move AWS account`.

With this, you have successfully set up your AWS account and created an AWS Organization!

## Restrict AWS Regions

You may not want all IAM accounts and member accounts of your AWS Organization to have access to all AWS regions and
create resources in regions that are not approved.

Refer to the examples provided by AWS on how to restrict regions for your member accounts:
[samples by AWS](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps_examples_general.html#example-scp-deny-region)

To restrict the regions that your member accounts can create resources in, follow the steps below:

1. Click on your username in the top right corner of the AWS Management Console and click on `Organization`
2. Click on `Policies` on the sidebar
3. Click on `Service control policies`
4. If `Service control policies` is not enabled, click on `Enable service control policies`
5. Click on `Create policy`
6. Enter a name for your policy
7. Enter a description for your policy if you wish
8. Paste the following code into the policy document field:
    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "DenyNotSingaporeRegion",
          "Effect": "Deny",
          "NotAction": [
            "a4b:*",
            "acm:*",
            "aws-marketplace-management:*",
            "aws-marketplace:*",
            "aws-portal:*",
            "budgets:*",
            "ce:*",
            "chime:*",
            "cloudfront:*",
            "config:*",
            "cur:*",
            "directconnect:*",
            "ec2:DescribeRegions",
            "ec2:DescribeTransitGateways",
            "ec2:DescribeVpnGateways",
            "fms:*",
            "globalaccelerator:*",
            "health:*",
            "iam:*",
            "importexport:*",
            "kms:*",
            "mobileanalytics:*",
            "networkmanager:*",
            "organizations:*",
            "pricing:*",
            "route53:*",
            "route53domains:*",
            "route53-recovery-cluster:*",
            "route53-recovery-control-config:*",
            "route53-recovery-readiness:*",
            "s3:GetAccountPublic*",
            "s3:ListAllMyBuckets",
            "s3:ListMultiRegionAccessPoints",
            "s3:PutAccountPublic*",
            "shield:*",
            "sts:*",
            "support:*",
            "trustedadvisor:*",
            "waf-regional:*",
            "waf:*",
            "wafv2:*",
            "wellarchitected:*"
          ],
          "Resource": "*",
          "Condition": {
            "StringNotEquals": {
              "aws:RequestedRegion": [
                "ap-southeast-1"
              ]
            }
          }
        }
      ]
    }
    ```
9. Click on `Create policy`

Your AWS accounts within your organization are now restricted to creating resources in the regions `ap-southeast-1`
Singapore region.

## Programmatic Access to AWS

Now that both your root and IAM accounts are set up, you need to create an access key and secret key for your IAM
account to access AWS programmatically.

To do so, follow the steps below:

1. Log into the AWS Management Console using your IAM account
2. Click on your username on the top right corner of the page and click on `Security Credentials`
3. Scroll down to the `Access keys` section and click on `Create access key`
4. Select `Command Line Interface (CLI)`
5. Select `I understand the above recommendation and want to proceed to create an access key.`
6. Click on `Next`
7. Give it a Description tag if you wish
8. Click on `Create access key`
9. Download the `.csv` file containing your access key and secret key, or save the access key and secret key in a
   secure location

> [!CAUTION]
> Do not share your access key and secret key with anyone. Keep them in a secure location.

## Conclusion

Congratulations! You have successfully set up your AWS account and AWS Organization!

If you wish to learn more about how to deploy the application onto AWS, refer to the
[Deployment Guide](Deployment%20Guide.md).

If you wish to learn more about how to set up the application locally and develop it, refer to the
[Developer Guide](Developer%20Guide.md).

If you wish to just install the application locally on your machine and use it without any further development, refer
to the [Installation Guide](Installation%20Guide.md).

If you wish to learn more about how to use the application from the user's perspective, refer to the
[User Guide](User%20Guide.md).
